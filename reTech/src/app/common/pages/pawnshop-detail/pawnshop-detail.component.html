<div class="min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50">
    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- Profile Header -->
        <div *ngIf="pawnShop$ | async as profile; else notLoggedIn" 
             class="relative bg-white rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 overflow-hidden mb-8">
            <button 
                (click)="goBack()" 
                class="absolute top-4 left-4 bg-gray-100 hover:bg-gray-200 text-gray-800 font-semibold px-3 py-1 rounded shadow transition flex items-center gap-1">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
            </button>
            <!-- Header Section with gradient background -->
            <div class="bg-gradient-to-r from-blue-500 to-indigo-600 p-8">
                <div class="flex flex-col md:flex-row items-center md:items-start gap-6">
                    
                    <!-- Avatar with modern styling and border -->
                    <div class="relative group">
                        <div class="absolute inset-0 bg-white rounded-full blur-xl opacity-50 group-hover:opacity-75 transition-opacity"></div>
                        <img [src]="profile?.logoUrl || 'assets/png/default-pawnshop.jpg'"
                             alt="pawnshop-logo"
                             class="relative rounded-full w-32 h-32 md:w-48 md:h-48 object-cover border-4 border-white shadow-2xl" />
                    </div>

                    <!-- Info section with improved typography -->
                    <div class="flex-1 text-center md:text-left" *ngIf="profile">
                        <h1 class="text-3xl md:text-4xl font-bold text-white mb-4">
                            {{ profile?.name || 'Pawnshop name' }}
                        </h1>
                        <div class="flex items-center justify-center md:justify-start gap-2 mb-4 text-white/90 text-sm">
                            <i class="fa-solid fa-location-dot"></i>
                            <span>{{ profile?.address || 'Адрес не указан' }}</span>
                            <span>{{ profile?.city?.name }}</span>
                        </div>
                        <!-- Status badges in a flex container -->
                        <div class="flex flex-wrap items-center justify-center md:justify-start gap-4 mb-4">
                            <!-- Time badge -->
                            <div class="flex items-center gap-2 bg-white/20 backdrop-blur-sm rounded-full px-4 py-2">
                                <i class="fa-regular fa-clock text-white"></i>
                                <span class="text-white font-medium text-sm">
                                    {{ profile?.openTime }} – {{ profile?.closeTime }}
                                </span>
                                <span [ngClass]="{
                                    'bg-green-500': isOpenNow,
                                    'bg-red-500': !isOpenNow
                                }" class="px-3 py-1 rounded-full text-white text-xs font-bold">
                                    {{ isOpenNow ? 'Открыто' : 'Закрыто' }}
                                </span>
                            </div>

                            <!-- Current time badge -->
                            <div class="flex items-center gap-2 bg-white/20 backdrop-blur-sm rounded-full px-4 py-2">
                                <i class="fa-regular fa-clock text-white"></i>
                                <span class="text-white font-medium text-sm">
                                    {{ currentTime | date:'shortTime' }}
                                </span>
                            </div>

                            <!-- Rating -->
                            <div class="flex items-center gap-1 bg-white/20 backdrop-blur-sm rounded-full px-4 py-2">
                                <ng-container *ngFor="let star of [1, 2, 3, 4, 5]">
                                    <i class="fa-star text-yellow-300"
                                       [ngClass]="{
                                           'fa-solid': profile.rating >= star,
                                           'fa-regular opacity-50': profile.rating < star
                                       }"></i>
                                </ng-container>
                                <span class="text-white font-semibold text-sm ml-1">{{ profile.rating?.toFixed(1) }}</span>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Description and Terms Section with better layout -->
            <div class="p-6 md:p-8">
                <!-- Header with About Us and Terms -->
                <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6">
                    <h3 class="text-xl font-bold text-gray-800 flex items-center gap-2">
                        <i class="fa-regular fa-file-lines text-blue-600"></i>
                       {{'About the pawnshop' | translate}}
                    </h3>
                    <div class="flex gap-3">
                        <button *ngIf="profile?.terms"
                                (click)="openTermsModal()"
                                class="flex items-center gap-2 px-6 py-2.5 bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white rounded-full font-semibold transition-all duration-300 shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                            <i class="fa-solid fa-scale-balanced"></i>
                            {{'Terms of the pawnshop' | translate}}
                        </button>
        
                        <button (click)="openEvaluationModal()"
                                class="flex items-center gap-2 px-6 py-2.5 bg-gradient-to-r from-green-500 to-emerald-600 
                                        hover:from-green-600 hover:to-emerald-700 text-white rounded-full font-semibold 
                                        transition-all duration-300 shadow-md hover:shadow-lg">
                            <i class="fa-solid fa-camera"></i>
                            {{'Evaluate an item' | translate}}
                        </button>
                    </div>
                </div>

                <!-- Terms expandable section with modern card styling -->
                <div *ngIf="showTerms && profile?.terms"
                        class="mb-6 p-6 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl border border-blue-200 shadow-sm">

                    <h4 class="text-lg font-bold text-gray-800 flex items-center gap-2 mb-4">
                        <i class="fa-solid fa-scale-balanced text-blue-600"></i>
                        {{'Terms of the pawnshop' | translate}}
                    </h4>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

                        <!-- Процентная ставка -->
                        <div *ngIf="profile.terms.interest?.rate"
                            class="flex items-center gap-3 p-3 bg-white rounded-lg">
                        <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center">
                            <i class="fa-solid fa-percent text-blue-600"></i>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500 font-medium">{{'Interest rate' | translate}}</p>
                            <p class="text-sm font-bold text-gray-800">
                            {{ profile.terms.interest.rate }}%
                            <span class="text-xs text-gray-500">
                                / {{ profile.terms.interest.period === 'day' ? 'день' : 'месяц' }}
                            </span>
                            </p>
                        </div>
                        </div>

                        <!-- Минимальный срок начисления -->
                        <div *ngIf="profile.terms.interest?.minChargeDays"
                            class="flex items-center gap-3 p-3 bg-white rounded-lg">
                        <div class="w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center">
                            <i class="fa-solid fa-calendar-days text-indigo-600"></i>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500 font-medium">{{'Minimum charge period' | translate}}</p>
                            <p class="text-sm font-bold text-gray-800">
                            {{ profile.terms.interest.minChargeDays }} {{'days' | translate }}
                            </p>
                        </div>
                        </div>

                        <!-- Максимальная сумма -->
                        <div *ngIf="profile.terms.limits?.maxAmount"
                            class="flex items-center gap-3 p-3 bg-white rounded-lg">
                        <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center">
                            <i class="fa-solid fa-money-bill-wave text-green-600"></i>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500 font-medium">{{'Maximum amount' | translate}}</p>
                            <p class="text-sm font-bold text-gray-800">
                            {{ profile.terms.limits.maxAmount | number:'1.0-0' }} ₸
                            </p>
                        </div>
                        </div>

                        <!-- Комиссия -->
                        <div *ngIf="profile.terms.fees"
                            class="flex items-center gap-3 p-3 bg-white rounded-lg">
                        <div class="w-10 h-10 rounded-full bg-yellow-100 flex items-center justify-center">
                            <i class="fa-solid fa-coins text-yellow-600"></i>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500 font-medium">{{'Commission' | translate}}</p>
                            <p class="text-sm font-bold text-gray-800">
                            {{ profile.terms.fees.value }}
                            {{ profile.terms.fees.type === 'percent' ? '%' : '₸' }}
                            </p>
                        </div>
                        </div>

                        <!-- Корректировка цены -->
                        <div *ngIf="profile.terms.priceAdjustmentLimitPercent"
                            class="flex items-center gap-3 p-3 bg-white rounded-lg md:col-span-2">
                        <div class="w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center">
                            <i class="fa-solid fa-arrows-left-right text-purple-600"></i>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500 font-medium">{{'Price adjustment limit' | translate}}</p>
                            <p class="text-sm font-bold text-gray-800">
                            ±{{ profile.terms.priceAdjustmentLimitPercent }}%
                            </p>
                        </div>
                        </div>

                        </div>
                </div>


                <!-- Description with better typography -->
                <p class="text-gray-600 leading-relaxed text-base">
                    {{ profile?.description || 'Описание пока отсутствует' }}
                </p>
            </div>
        </div>

        <!-- Not logged in alert with modern styling -->
        <ng-template #notLoggedIn>
            <div class="bg-yellow-50 border-l-4 border-yellow-400 rounded-lg p-6 shadow-md mb-8">
                <div class="flex items-start gap-4">
                    <div class="flex-shrink-0">
                        <i class="fa-solid fa-lock text-yellow-500 text-3xl"></i>
                    </div>
                    <div>
                        <h3 class="text-lg font-bold text-gray-800 mb-2">{{ 'You are not logged in' | translate }}</h3>
                        <p class="text-gray-600">
                            {{ 'Please' | translate }}
                            <a routerLink="/login" class="text-blue-600 font-semibold hover:text-blue-800 transition-colors">{{ 'log in' | translate }}</a>
                            {{ 'or' | translate }}
                            <a routerLink="/register" class="text-blue-600 font-semibold hover:text-blue-800 transition-colors">{{ 'register' | translate }}</a>.
                        </p>
                    </div>
                </div>
            </div>
        </ng-template>

        <!-- Main content grid with responsive layout -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 md:gap-8">
            
            <!-- Photo Gallery with modern card -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 p-6" 
                     *ngIf="pawnShop$ | async as profile">
                    <h3 class="text-xl font-bold text-gray-800 flex items-center gap-2 mb-6">
                        <i class="fa-regular fa-images text-blue-600"></i>
                        {{'Photos of the pawnshop' |translate}}
                    </h3>

                    <div class="grid grid-cols-2 gap-3">
                        <div *ngFor="let photo of profile.photos" 
                             class="relative aspect-square rounded-xl overflow-hidden group cursor-pointer shadow-md hover:shadow-xl transition-all duration-300">
                            <img [src]="photo" 
                                 alt="Фото ломбарда"
                                 class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300" />
                                 
                            <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-300"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Products Section with modern design -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 p-6" 
                     *ngIf="products$ | async as products">
                    <h3 class="text-xl font-bold text-gray-800 flex items-center gap-2 mb-6">
                        <i class="fa-solid fa-box-open text-blue-600"></i>
                        {{'Products for Sale' | translate}}
                    </h3>

                    <div *ngIf="products.length > 0; else noProducts" 
                         class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div *ngFor="let product of products" 
                             (click)="openProductDetail(product)"
                             class="group relative bg-white rounded-xl border border-gray-200 overflow-hidden hover:shadow-xl transition-all duration-300 cursor-pointer hover:-translate-y-1">
                            
                            <!-- Product Image -->
                            <div class="relative aspect-square overflow-hidden bg-gray-100">
                                <img [src]="product.photos[0].url" 
                                     alt="product photo"
                                     class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300" />
                                
                                <!-- Favorite Button -->
                                <button (click)="toggleFavoriteItem(product._id, $event)"
                                        class="absolute top-3 right-3 w-9 h-9 rounded-full bg-white/90 backdrop-blur-sm flex items-center justify-center shadow-lg hover:scale-110 transition-all duration-300 z-10">
                                    <i class="fa-solid fa-heart"
                                       [ngClass]="{
                                           'text-red-500': user?.favoriteItems?.includes(product._id),
                                           'text-gray-400': !user?.favoriteItems?.includes(product._id)
                                       }"></i>
                                </button>
                            </div>

                            <!-- Product Info -->
                            <div class="p-4">
                                <h4 class="font-semibold text-gray-800 mb-2 line-clamp-2 group-hover:text-blue-600 transition-colors">
                                    {{ product.title }}
                                </h4>
                                <div class="flex items-center justify-between">
                                    <span class="text-lg font-bold text-blue-600">{{ product.price | number }} ₸</span>
                                    <span class="text-xs text-gray-500">{{ product.createdAt | date: 'd MMMM' }}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <ng-template #noProducts>
                        <div class="text-center py-12">
                            <i class="fa-solid fa-box-open text-gray-300 text-5xl mb-4"></i>
                            <p class="text-gray-500">{{'No products available' | translate}}</p>
                        </div>
                    </ng-template>
                </div>
            </div>
        </div>

        <!-- Reviews Section with modern card design -->
        <div class="mt-8 bg-white rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 p-6 md:p-8" 
             *ngIf="pawnShop$ | async as profile">
            <h3 class="text-xl font-bold text-gray-800 flex items-center gap-2 mb-6">
                <i class="fa-regular fa-comment-dots text-blue-600"></i>
                Отзывы
                <span class="ml-2 px-3 py-1 bg-gray-100 text-gray-600 text-sm rounded-full">
                    {{ profile.reviews?.length || 0 }}
                </span>
            </h3>

            <!-- Average Rating Display -->
            <div class="flex items-center gap-4 mb-6 p-4 bg-gradient-to-r from-yellow-50 to-orange-50 rounded-xl">
                <div class="flex items-center gap-1">
                    <ng-container *ngFor="let star of [1,2,3,4,5]">
                        <i class="fa-star text-2xl"
                           [ngClass]="{
                               'fa-solid text-yellow-400': (profile.rating || 0) >= star,
                               'fa-regular text-gray-300': (profile.rating || 0) < star
                           }"></i>
                    </ng-container>
                </div>
                <span class="text-2xl font-bold text-gray-800">{{ profile.rating?.toFixed(1) || 0 }}<span class="text-gray-400 text-lg">/5</span></span>
            </div>

            <!-- Reviews List with modern card styling -->
            <div *ngIf="profile.reviews?.length > 0; else noReviews" class="space-y-4 mb-8">
                <div *ngFor="let review of profile.reviews | slice:-3" 
                     class="p-5 bg-gray-50 rounded-xl border border-gray-200 hover:shadow-md transition-all duration-300">
                    <div class="flex items-start justify-between mb-3">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center text-white font-bold">
                                {{ (review.userName || 'Пользователь').charAt(0).toUpperCase() }}
                            </div>
                            <div>
                                <p class="font-semibold text-gray-800">{{ review.userName || 'Пользователь' }}</p>
                                <div class="flex items-center gap-1 mt-1">
                                    <ng-container *ngFor="let star of [1,2,3,4,5]">
                                        <i class="fa-star text-xs"
                                           [ngClass]="{
                                               'fa-solid text-yellow-400': review.rating >= star,
                                               'fa-regular text-gray-300': review.rating < star
                                           }"></i>
                                    </ng-container>
                                </div>
                            </div>
                        </div>
                        <span class="text-xs text-gray-500">{{ review.createdAt | date:'dd MMM yyyy' }}</span>
                    </div>
                    <p class="text-gray-700 leading-relaxed">{{ review.comment }}</p>
                </div>
            </div>

            <ng-template #noReviews>
                <div class="text-center py-8 mb-8">
                    <i class="fa-regular fa-comment text-gray-300 text-4xl mb-3"></i>
                    <p class="text-gray-500">{{'No reviews yet' | translate}}</p>
                </div>
            </ng-template>

            <!-- Add Review Form with modern styling -->
            <div class="p-6 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl border border-blue-200">
                <h4 class="text-lg font-bold text-gray-800 mb-4">{{'Leave a review' | translate}}</h4>

                <!-- Star Rating -->
                <div class="flex items-center gap-2 mb-1">
                    <span class="text-sm font-medium text-gray-600">Ваша оценка:</span>
                    <ng-container *ngFor="let star of [1,2,3,4,5]">
                    <i
                        class="fa-star text-2xl cursor-pointer transition-all duration-200 hover:scale-110"
                        [ngClass]="{
                        'fa-solid text-yellow-400': star <= newRating,
                        'fa-regular text-gray-300': star > newRating
                        }"
                        (click)="newRating = star; ratingError = false"
                    ></i>
                    </ng-container>
                </div>

                <p *ngIf="roleError" class="text-sm text-red-600 mb-3">
                    {{ 'You cannot leave reviews for pawnshops' | translate }}
                </p>

                <!-- Rating error -->
                <p *ngIf="ratingError" class="text-sm text-red-600 mb-3">
                    {{'Select a rating' | translate}}
                </p>

                <!-- Comment -->
                <textarea
                    [(ngModel)]="newComment"
                    (ngModelChange)="commentError = false"
                    class="w-full p-4 border rounded-xl resize-none bg-white
                        transition-all duration-300
                        focus:ring-2 focus:ring-blue-500
                        focus:border-transparent"
                    rows="4"
                    placeholder="Поделитесь своим опытом..."
                ></textarea>

                <!-- Comment error -->
                <p *ngIf="commentError" class="text-sm text-red-600 mt-2">
                    {{'Add a comment' | translate}}
                </p>

                <!-- Submit -->
                <button
                    (click)="submitReview(profile._id)"
                    class="mt-4 px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600
                        hover:from-blue-600 hover:to-indigo-700 text-white rounded-xl
                        font-semibold transition-all duration-300 shadow-md
                        hover:shadow-lg flex items-center gap-2"
                >
                    <i class="fa-solid fa-paper-plane"></i>
                    {{'Submit Review' | translate}}
                </button>
            </div>

        </div>

    </div>
</div>
