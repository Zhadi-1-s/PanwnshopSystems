<div class="min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8">
    
    <!-- Header Section -->
    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-4 sm:p-6 mb-6">
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
        <h3 class="text-2xl sm:text-3xl font-bold text-gray-900">{{'Products list'|translate}}</h3>
        <span class="inline-flex items-center px-4 py-2 bg-blue-50 text-blue-700 rounded-full text-sm font-semibold">
          {{ (filteredProducts$ | async)?.length || 0 }} {{ 'Results' | translate }}
        </span>
      </div>

      <!-- Search Box -->
      <div class="mb-6">
        <div class="relative">
          <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
            <i class="fa-solid fa-search text-gray-400"></i>
          </div>
          <input
            type="text"
            class="w-full pl-11 pr-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 text-gray-900 placeholder-gray-400"
            placeholder="Поиск по названию..."
            [(ngModel)]="searchTerm$.value"
            (ngModelChange)="onSearchChange($event)"
          />
        </div>
      </div>

      <!-- Filter Section -->
      <div class="space-y-4">
        <div class="flex flex-wrap items-center gap-3">
          <!-- Filter Toggle Button -->
          <button 
            class="inline-flex items-center gap-2 px-5 py-2.5 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-xl font-medium transition-all duration-200 shadow-md hover:shadow-lg transform hover:-translate-y-0.5"
            (click)="toogleFilterBlock = !toogleFilterBlock">
            <span>{{'Filters' | translate}}</span>
            <i class="fa-solid fa-sliders"></i>
          </button>
          <button
            class="inline-flex items-center gap-2 px-5 py-2.5
                  bg-pink-50 hover:bg-pink-100
                  text-pink-700 rounded-xl font-medium
                  border border-pink-200
                  transition-all duration-200 shadow-sm"
            (click)="toggleFavorites()"
          >
            <i class="fa-solid fa-heart"></i>
            <span>{{'Favorites' | translate}}</span>

            <span
              *ngIf="(favoriteItems$ | async)?.length"
              class="ml-1 px-2 py-0.5 text-xs font-bold bg-pink-600 text-white rounded-full"
            >
              {{ (favoriteItems$ | async)?.length }}
            </span>
          </button>

          <!-- Applied Filters -->
          <div class="flex flex-wrap gap-2" *ngIf="(appliedFilters$ | async)?.length">
            <span 
              *ngFor="let filter of appliedFilters$ | async" 
              class="inline-flex items-center gap-2 px-3 py-1.5 bg-blue-100 text-blue-700 rounded-lg text-sm font-medium">
              {{ filter }}
            </span>
          </div>
        </div>

        <!-- Expandable Filter Block -->
        <div 
          [@filterAnimation]="toogleFilterBlock ? 'open' : 'closed'"
          class="bg-gradient-to-br from-gray-50 to-blue-50/30 rounded-xl p-4 sm:p-6 border border-gray-200">
          
          <!-- Price Sliders -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <!-- Price From -->
            <div class="space-y-3">
              <label class="block text-sm font-semibold text-gray-700">Цена от</label>
              <ngx-slider 
                *ngIf="isBrowser"
                [(value)]="priceFrom"
                [options]="sliderMinOptions">
              </ngx-slider>
              <div class="text-right">
                <span class="inline-flex items-center px-4 py-2 bg-white rounded-lg text-lg font-bold text-gray-900 shadow-sm border border-gray-200">
                  {{ priceFrom | number:'1.0-0' }} ₸
                </span>
              </div>
            </div>

            <!-- Price To -->
            <div class="space-y-3">
              <label class="block text-sm font-semibold text-gray-700">Цена до</label>
              <ngx-slider 
                *ngIf="isBrowser"
                [(value)]="priceTo"
                [options]="sliderMaxOptions">
              </ngx-slider>
              <div class="text-right">
                <span class="inline-flex items-center px-4 py-2 bg-white rounded-lg text-lg font-bold text-gray-900 shadow-sm border border-gray-200">
                  {{ priceTo | number:'1.0-0' }} ₸
                </span>
              </div>
            </div>
          </div>

          <!-- Тип товара -->
          <div class="flex gap-3 mb-4">
            <button
              (click)="setTypeFilter('all')"
              [ngClass]="typeFilter === 'all'
                ? 'bg-blue-100 text-blue-700 border-blue-300'
                : 'bg-white text-gray-700 border-gray-300 hover:bg-blue-50'"
              class="px-4 py-1 rounded-lg border transition-colors">
              {{ 'All' | translate }}
            </button>

            <button
              (click)="setTypeFilter('sale')"
              [ngClass]="typeFilter === 'sale'
                ? 'bg-blue-100 text-blue-700 border-blue-300'
                : 'bg-white text-gray-700 border-gray-300 hover:bg-blue-50'"
              class="px-4 py-1 rounded-lg border transition-colors">
              {{ 'Sale' | translate }}
            </button>

            <button
              (click)="setTypeFilter('loan')"
              [ngClass]="typeFilter === 'loan'
                ? 'bg-blue-100 text-blue-700 border-blue-300'
                : 'bg-white text-gray-700 border-gray-300 hover:bg-blue-50'"
              class="px-4 py-1 rounded-lg border transition-colors">
              {{ 'Loan' | translate }}
            </button>
          </div>

          <!-- Help Tooltips -->
          <div class="flex flex-wrap gap-2 mb-6" *ngIf="searchHelpItemsList?.length">
            <div 
              *ngFor="let item of searchHelpItemsList" 
              class="px-3 py-1.5 bg-white hover:bg-blue-50 border border-gray-200 hover:border-blue-300 rounded-lg text-sm text-gray-700 hover:text-blue-700 cursor-pointer transition-all duration-200"
              (click)="onHelpItemClick(item)">
              <span>{{ item | translate}}</span>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="flex flex-wrap gap-3">
            <button 
              class="px-6 py-2.5 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-xl font-medium transition-all duration-200 shadow-md hover:shadow-lg transform hover:-translate-y-0.5"
              (click)="updateAppliedFilters()">
              {{'Apply' | translate}}
            </button>
            <button 
              class="px-6 py-2.5 bg-white hover:bg-gray-50 text-gray-700 border border-gray-300 hover:border-gray-400 rounded-xl font-medium transition-all duration-200"
              (click)="clearFilters()">
              {{'Clear' | translate}}
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="flex justify-center items-center py-16">
      <div class="relative">
        <div class="w-16 h-16 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin"></div>
      </div>
    </div>

    <!-- Products Grid -->
    <div *ngIf="!isLoading">
      <div *ngIf="(filteredProducts$ | async) as products; else loading">
        
        <div *ngIf="products.length > 0; else noProducts" 
          class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-5">
          
          <div *ngFor="let product of products" 
            class="group relative bg-white rounded-2xl border border-gray-100 overflow-hidden transition-all duration-300 hover:shadow-xl hover:shadow-blue-100/50 hover:border-blue-100 hover:-translate-y-1.5 cursor-pointer"
            (click)="openProductDetails(product)">
            
            <!-- Product Image Container -->
            <div class="relative overflow-hidden bg-gradient-to-br from-slate-50 to-gray-100">
              <div class="aspect-[4/3]">
                <!-- Type Badge -->
                <div
                  class="absolute top-2.5 left-2.5 px-2.5 py-1 rounded-lg text-xs font-semibold backdrop-blur-md border shadow-sm"
                  [ngClass]="product.type === 'loan'
                    ? 'bg-amber-100/90 text-amber-700 border-amber-200'
                    : 'bg-emerald-100/90 text-emerald-700 border-emerald-200'">

                  <i
                    class="fa-solid mr-1"
                    [ngClass]="product.type === 'loan' ? 'fa-hand-holding-dollar' : 'fa-tag'">
                  </i>

                  {{ product.type === 'loan' ? ('Loan' | translate) : ('Sale' | translate) }}
                </div>
                <img
                  *ngIf="product.photos?.length > 0; else noPhoto"
                  [src]="product.photos[0].url"
                  class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500 ease-out"
                  alt="{{ product.title }}"
                />

                <ng-template #noPhoto>
                  <div class="w-full h-full flex items-center justify-center">
                    <div class="text-center">
                      <i class="fa-solid fa-cube text-gray-200 text-4xl"></i>
                    </div>
                  </div>
                </ng-template>
              </div>

              <!-- Gradient Overlay -->
              <div class="absolute inset-0 bg-gradient-to-t from-black/20 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>

              <!-- Favorite Button -->
              <button
                class="absolute top-3 right-3 w-9 h-9 flex items-center justify-center bg-white/90 backdrop-blur-md rounded-xl shadow-sm border border-white/50 transition-all duration-200 hover:scale-110 hover:bg-white z-10"
                (click)="toggleFavorite(product, $event)">
                <i 
                  class="fa-solid fa-heart text-base transition-all duration-200"
                  [ngClass]="isFavorite(product._id) ? 'text-rose-500 scale-110' : 'text-gray-300'">
                </i>
              </button>

              <!-- Category Badge -->
              <div class="absolute bottom-2.5 left-2.5 px-2.5 py-1 bg-white/90 backdrop-blur-md rounded-lg text-xs font-medium text-gray-600 border border-white/50 shadow-sm">
                {{ product.category | translate }}
              </div>
            </div>

            <!-- Product Info -->
            <div class="p-4 space-y-2.5">
              <!-- Title -->
              <h5 class="text-sm font-semibold text-gray-800 leading-snug line-clamp-2 group-hover:text-blue-600 transition-colors duration-200">
                {{ product.title }}
              </h5>

              <!-- Price & Date Row -->
              <div class="flex items-end justify-between gap-2">
                <div class="space-y-0.5">
                  <span class="block text-lg font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent">
                    {{ product.price | number:'1.0-0' }} ₸
                  </span>
                </div>
                <span class="text-xs text-gray-400 font-medium whitespace-nowrap">
                  {{ product.createdAt | date:'dd MMM' }}
                </span>
              </div>
            </div>

            <!-- Hover Action Indicator -->
            <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-blue-500 to-indigo-500 transform scale-x-0 group-hover:scale-x-100 transition-transform duration-300 origin-left"></div>
          </div>
        </div>

        <!-- Empty State -->
        <ng-template #noProducts>
          <div class="bg-gradient-to-br from-white to-slate-50 rounded-2xl border border-gray-100 p-14 text-center">
            <div class="max-w-sm mx-auto space-y-4">
              <div class="w-20 h-20 mx-auto bg-gradient-to-br from-blue-50 to-indigo-100 rounded-2xl flex items-center justify-center shadow-inner">
                <i class="fa-solid fa-box-open text-blue-400 text-3xl"></i>
              </div>
              <div class="space-y-2">
                <p class="text-lg font-semibold text-gray-700">Нет доступных товаров</p>
                <p class="text-sm text-gray-400">Попробуйте изменить параметры поиска или фильтры</p>
              </div>
            </div>
          </div>
        </ng-template>
      </div>
    </div>

    <!-- Loading State -->
    <ng-template #loading>
      <div class="flex flex-col items-center justify-center py-14 space-y-4">
        <div class="relative">
          <div class="w-12 h-12 border-2 border-blue-100 rounded-full"></div>
          <div class="absolute inset-0 w-12 h-12 border-2 border-transparent border-t-blue-500 rounded-full animate-spin"></div>
        </div>
        <span class="text-sm text-gray-400 font-medium">Загрузка...</span>
      </div>
    </ng-template>

  </div>
</div>
